data = [
0.00	0.00	1004.00	127.50
0.00	0.00	1009.00	127.50
0.01	1.57	1014.00	127.50
0.02	1.57	1019.00	127.50
0.02	1.57	1024.00	127.50
0.04	3.14	1029.00	127.50
0.05	3.14	1034.00	127.50
0.07	3.14	1039.00	127.50
0.09	3.14	1044.00	127.50
0.10	3.14	1049.00	127.50
0.12	3.93	1054.00	127.50
0.14	3.93	1059.00	127.50
0.16	4.71	1064.00	127.50
0.18	3.14	1069.00	127.50
0.20	4.71	1074.00	127.50
0.23	4.71	1079.00	127.50
0.26	5.50	1084.00	127.50
0.28	4.71	1089.00	127.50
0.31	5.50	1094.00	127.50
0.33	5.50	1099.00	127.50
0.36	5.50	1104.00	127.50
0.39	4.58	1110.00	127.50
0.42	5.50	1115.00	127.50
0.44	5.50	1120.00	127.50
0.47	5.50	1125.00	127.50
0.50	6.28	1130.00	127.50
0.53	5.50	1135.00	127.50
0.56	6.28	1140.00	127.50
0.59	5.50	1145.00	127.50
0.62	6.28	1150.00	127.50
0.64	4.71	1155.00	127.50
0.67	5.50	1160.00	127.50
0.70	6.28	1165.00	127.50
0.73	6.28	1170.00	127.50
0.77	6.28	1175.00	127.50
0.79	5.50	1180.00	127.50
0.82	6.28	1185.00	127.50
0.86	6.28	1190.00	127.50
0.88	4.71	1195.00	127.50
0.91	6.28	1200.00	127.50
0.94	6.28	1205.00	127.50
0.97	6.28	1210.00	127.50
1.00	5.50	1215.00	127.50
1.03	6.28	1220.00	127.50
1.06	6.28	1225.00	127.50
1.10	6.28	1230.00	127.50
1.13	6.28	1235.00	127.50
1.15	4.71	1240.00	127.50
1.18	6.28	1245.00	127.50
1.21	6.28	1250.00	127.50
1.24	6.28	1255.00	127.50
1.28	6.28	1260.00	127.50
1.31	6.28	1265.00	127.50
1.34	6.28	1270.00	127.50
1.37	6.28	1275.00	127.50
1.39	4.71	1280.00	127.50
1.43	6.28	1285.00	127.50
1.46	6.28	1290.00	127.50
1.49	6.28	1295.00	127.50
1.52	6.28	1300.00	127.50
1.55	6.28	1305.00	127.50
1.58	6.28	1310.00	127.50
1.61	6.28	1315.00	127.50
1.65	6.28	1320.00	127.50
1.67	4.71	1325.00	127.50
1.70	6.28	1330.00	127.50
1.73	6.28	1335.00	127.50
1.76	6.28	1340.00	127.50
1.79	6.28	1345.00	127.50
1.83	6.28	1350.00	127.50
1.86	6.28	1355.00	127.50
1.89	6.28	1360.00	127.50
1.92	5.24	1366.00	127.50
1.95	6.28	1371.00	127.50
1.98	6.28	1376.00	127.50
2.01	6.28	1381.00	127.50
2.05	6.28	1386.00	127.50
2.08	7.07	1391.00	127.50
2.11	6.28	1396.00	127.50
2.14	6.28	1401.00	127.50
2.18	6.28	1406.00	127.50
2.20	4.71	1411.00	127.50
2.23	6.28	1416.00	127.50
2.26	6.28	1421.00	127.50
2.29	6.28	1426.00	127.50
2.32	6.28	1431.00	127.50
2.36	6.28	1436.00	127.50
2.39	6.28	1441.00	127.50
2.42	6.28	1446.00	127.50
2.45	5.50	1451.00	127.50
2.48	6.28	1456.00	127.50
2.51	6.28	1461.00	127.50
2.54	6.28	1466.00	127.50
2.57	6.28	1471.00	127.50
2.60	6.28	1476.00	127.50
2.64	6.28	1481.00	127.50
2.67	6.28	1486.00	127.50
2.70	6.28	1491.00	127.50
2.72	4.71	1496.00	127.50
2.75	6.28	1501.00	127.50
2.78	6.28	1506.00	127.50
2.82	6.28	1511.00	127.50
2.85	6.28	1516.00	127.50
2.88	6.28	1521.00	127.50
2.91	7.07	1526.00	127.50
2.95	6.28	1531.00	127.50
2.97	4.71	1536.00	127.50
3.00	6.28	1541.00	127.50
3.03	6.28	1546.00	127.50
3.06	6.28	1551.00	127.50
3.09	6.28	1556.00	127.50
3.13	6.28	1561.00	127.50
3.16	6.28	1566.00	127.50
3.19	6.28	1571.00	127.50
3.22	6.28	1576.00	127.50
3.24	4.71	1581.00	127.50
3.28	7.07	1586.00	127.50
3.31	6.28	1591.00	127.50
3.34	6.28	1596.00	127.50
3.37	6.28	1601.00	127.50
3.40	6.28	1606.00	127.50
3.44	6.28	1611.00	127.50
3.47	6.28	1616.00	127.50
3.50	5.24	1622.00	127.50
3.53	6.28	1627.00	127.50
3.56	6.28	1632.00	127.50
3.59	6.28	1637.00	127.50
3.62	6.28	1642.00	127.50
3.66	6.28	1647.00	127.50
3.69	6.28	1652.00	127.50
3.72	6.28	1657.00	127.50
3.75	6.28	1662.00	127.50
3.78	5.50	1667.00	127.50
3.81	6.28	1672.00	127.50
3.84	6.28	1677.00	127.50
3.87	6.28	1682.00	127.50
3.90	6.28	1687.00	127.50
3.93	6.28	1692.00	127.50
3.97	6.28	1697.00	127.50
4.00	6.28	1702.00	127.50
4.02	4.71	1707.00	127.50
4.05	6.28	1712.00	127.50
4.08	6.28	1717.00	127.50
4.12	6.28	1722.00	127.50
4.15	6.28	1727.00	127.50
4.18	6.28	1732.00	127.50
4.21	6.28	1737.00	127.50
4.24	6.28	1742.00	127.50
4.28	7.07	1747.00	127.50
4.30	4.71	1752.00	127.50
4.33	6.28	1757.00	127.50
4.36	6.28	1762.00	127.50
4.39	6.28	1767.00	127.50
4.43	6.28	1772.00	127.50
4.46	6.28	1777.00	127.50
4.49	6.28	1782.00	127.50
4.52	6.28	1787.00	127.50
4.55	5.50	1792.00	127.50
4.58	6.28	1797.00	127.50
4.61	6.28	1802.00	127.50
4.64	6.28	1807.00	127.50
4.67	6.28	1812.00	127.50
4.70	6.28	1817.00	127.50
4.74	6.28	1822.00	127.50
4.77	6.28	1827.00	127.50
4.80	6.28	1832.00	127.50
4.82	4.71	1837.00	127.50
4.85	6.28	1842.00	127.50
4.89	6.28	1847.00	127.50
4.92	6.28	1852.00	127.50
4.95	7.07	1857.00	127.50
4.98	6.28	1862.00	127.50
5.01	6.28	1867.00	127.50
5.05	6.28	1872.00	127.50
5.08	5.24	1878.00	127.50
5.11	6.28	1883.00	127.50
5.14	6.28	1888.00	127.50
5.17	6.28	1893.00	127.50
5.20	6.28	1898.00	127.50
5.23	6.28	1903.00	127.50
5.27	6.28	1908.00	127.50
5.30	6.28	1913.00	127.50
5.33	6.28	1918.00	127.50
5.35	4.71	1923.00	127.50
5.38	6.28	1928.00	127.50
5.42	7.07	1933.00	127.50
5.45	6.28	1938.00	127.50
5.48	6.28	1943.00	127.50
5.51	6.28	1948.00	127.50
5.54	6.28	1953.00	127.50
5.58	6.28	1958.00	127.50
5.60	4.71	1963.00	127.50
5.63	6.28	1968.00	127.50
5.66	6.28	1973.00	127.50
5.69	6.28	1978.00	127.50
5.73	6.28	1983.00	127.50
5.76	6.28	1988.00	127.50
5.79	7.07	1993.00	127.50
5.82	6.28	1998.00	127.50
];

outData = [
0.00	0.00	1004.00
0.00	0.00	1009.00
0.00	0.39	1014.00
0.00	0.00	1019.00
0.00	0.39	1024.00
0.01	0.79	1029.00
0.01	0.39	1034.00
0.01	0.79	1039.00
0.02	0.79	1044.00
0.02	0.79	1049.00
0.03	0.79	1054.00
0.03	0.79	1059.00
0.04	1.18	1064.00
0.04	0.79	1069.00
0.05	1.18	1074.00
0.05	1.18	1079.00
0.06	1.18	1084.00
0.06	1.18	1089.00
0.07	1.18	1094.00
0.07	1.18	1099.00
0.08	1.57	1104.00
0.09	0.98	1110.00
0.09	1.18	1115.00
0.10	1.57	1120.00
0.11	1.18	1125.00
0.11	1.18	1130.00
0.12	1.57	1135.00
0.13	1.18	1140.00
0.14	1.57	1145.00
0.14	1.18	1150.00
0.15	1.18	1155.00
0.15	1.18	1160.00
0.16	1.57	1165.00
0.17	1.18	1170.00
0.17	1.57	1175.00
0.18	1.18	1180.00
0.19	1.18	1185.00
0.19	1.57	1190.00
0.20	0.79	1195.00
0.21	1.57	1200.00
0.21	1.18	1205.00
0.22	1.57	1210.00
0.23	1.18	1215.00
0.23	1.18	1220.00
0.24	1.18	1225.00
0.25	1.57	1230.00
0.25	1.18	1235.00
0.26	0.79	1240.00
0.26	1.18	1245.00
0.27	1.18	1250.00
0.27	1.18	1255.00
0.28	1.18	1260.00
0.28	1.18	1265.00
0.29	1.57	1270.00
0.30	1.18	1275.00
0.30	0.79	1280.00
0.31	1.18	1285.00
0.31	1.18	1290.00
0.32	1.18	1295.00
0.32	0.79	1300.00
0.33	1.18	1305.00
0.34	1.18	1310.00
0.34	1.18	1315.00
0.35	1.18	1320.00
0.35	0.79	1325.00
0.36	1.18	1330.00
0.36	0.79	1335.00
0.37	1.18	1340.00
0.37	0.79	1345.00
0.38	1.18	1350.00
0.38	0.79	1355.00
0.39	1.18	1360.00
0.39	0.65	1366.00
0.40	1.18	1371.00
0.40	0.79	1376.00
0.41	1.18	1381.00
0.41	0.79	1386.00
0.41	0.79	1391.00
0.42	1.18	1396.00
0.42	0.79	1401.00
0.43	1.18	1406.00
0.43	0.39	1411.00
0.44	1.18	1416.00
0.44	0.79	1421.00
0.45	0.79	1426.00
0.45	1.18	1431.00
0.46	0.79	1436.00
0.46	0.79	1441.00
0.46	0.79	1446.00
0.47	0.79	1451.00
0.47	0.79	1456.00
0.48	0.79	1461.00
0.48	0.79	1466.00
0.48	0.79	1471.00
0.49	0.79	1476.00
0.49	0.79	1481.00
0.49	0.79	1486.00
0.50	0.79	1491.00
0.50	0.79	1496.00
0.50	0.39	1501.00
0.51	0.79	1506.00
0.51	0.79	1511.00
0.52	0.79	1516.00
0.52	0.79	1521.00
0.52	0.39	1526.00
0.53	0.79	1531.00
0.53	0.79	1536.00
0.53	0.39	1541.00
0.54	0.79	1546.00
0.54	0.79	1551.00
0.54	0.79	1556.00
0.55	0.39	1561.00
0.55	0.79	1566.00
0.55	0.79	1571.00
0.56	0.39	1576.00
0.56	0.79	1581.00
0.56	0.39	1586.00
0.57	0.79	1591.00
0.57	0.79	1596.00
0.57	0.39	1601.00
0.58	0.79	1606.00
0.58	0.79	1611.00
0.58	0.39	1616.00
0.59	0.65	1622.00
0.59	0.79	1627.00
0.59	0.79	1632.00
0.59	0.39	1637.00
0.60	0.79	1642.00
0.60	0.79	1647.00
0.60	0.39	1652.00
0.61	0.79	1657.00
0.61	0.39	1662.00
0.61	0.79	1667.00
0.62	0.39	1672.00
0.62	0.79	1677.00
0.62	0.39	1682.00
0.63	0.79	1687.00
0.63	0.79	1692.00
0.63	0.39	1697.00
0.64	0.79	1702.00
0.64	0.39	1707.00
0.64	0.39	1712.00
0.64	0.79	1717.00
0.65	0.79	1722.00
0.65	0.39	1727.00
0.65	0.79	1732.00
0.66	0.79	1737.00
0.66	0.39	1742.00
0.66	0.79	1747.00
0.67	0.39	1752.00
0.67	0.79	1757.00
0.67	0.79	1762.00
0.68	0.39	1767.00
0.68	0.79	1772.00
0.68	0.39	1777.00
0.69	0.79	1782.00
0.69	0.79	1787.00
0.69	0.39	1792.00
0.70	0.79	1797.00
0.70	0.39	1802.00
0.70	0.79	1807.00
0.70	0.79	1812.00
0.71	0.39	1817.00
0.71	0.79	1822.00
0.71	0.39	1827.00
0.72	0.79	1832.00
0.72	0.79	1837.00
0.72	0.39	1842.00
0.73	0.79	1847.00
0.73	0.39	1852.00
0.73	0.79	1857.00
0.74	0.79	1862.00
0.74	0.39	1867.00
0.74	0.79	1872.00
0.74	0.33	1878.00
0.75	0.79	1883.00
0.75	0.79	1888.00
0.75	0.39	1893.00
0.76	0.79	1898.00
0.76	0.79	1903.00
0.76	0.39	1908.00
0.77	0.79	1913.00
0.77	0.39	1918.00
0.77	0.79	1923.00
0.78	0.39	1928.00
0.78	0.79	1933.00
0.78	0.79	1938.00
0.79	0.39	1943.00
0.79	0.79	1948.00
0.79	0.79	1953.00
0.80	0.39	1958.00
0.80	0.79	1963.00
0.80	0.39	1968.00
0.81	0.79	1973.00
0.81	0.39	1978.00
0.81	0.79	1983.00
0.81	0.79	1988.00
0.82	0.39	1993.00
0.82	0.79	1998.00
0.82	0.39	2003.00
0.83	0.79	2008.00
0.83	0.39	2013.00
0.83	0.79	2018.00
0.84	0.79	2023.00
0.84	0.39	2028.00
0.84	0.79	2033.00
0.85	0.79	2038.00
0.85	0.39	2043.00
0.85	0.39	2048.00
0.85	0.79	2053.00
0.86	0.79	2058.00
0.86	0.39	2063.00
0.86	0.79	2068.00
0.87	0.39	2073.00
0.87	0.79	2078.00
0.87	0.79	2083.00
0.88	0.39	2088.00
0.88	0.79	2093.00
0.88	0.39	2098.00
0.89	0.79	2103.00
0.89	0.39	2108.00
0.89	0.79	2113.00
0.90	0.79	2118.00
0.90	0.39	2123.00
0.90	0.79	2128.00
0.90	0.33	2134.00
0.91	0.79	2139.00
0.91	0.79	2144.00
0.91	0.39	2149.00
0.92	0.79	2154.00
0.92	0.79	2159.00
0.92	0.39	2164.00
0.93	0.79	2169.00
0.93	0.39	2174.00
0.93	0.79	2179.00
0.93	0.39	2184.00
0.94	0.79	2189.00
0.94	0.39	2194.00
0.94	0.79	2199.00
0.95	0.79	2204.00
0.95	0.39	2209.00
0.95	0.79	2214.00
0.96	0.39	2219.00
0.96	0.79	2224.00
0.96	0.79	2229.00
0.97	0.39	2234.00
0.97	0.79	2239.00
0.97	0.79	2244.00
0.98	0.39	2249.00
0.98	0.79	2254.00
0.98	0.39	2259.00
0.98	0.00	2264.00
0.98	0.39	2269.00
0.99	0.39	2274.00
0.99	0.00	2279.00
0.99	0.00	2284.00
0.99	0.00	2289.00
0.99	0.00	2294.00
0.99	0.00	2299.00
0.99	0.00	2304.00
0.99	0.00	2309.00
0.99	0.00	2314.00
0.99	0.00	2319.00
0.99	0.00	2324.00
0.99	0.00	2329.00
0.99	0.00	2334.00
0.99	0.00	2339.00
0.99	0.00	2344.00
0.99	0.00	2349.00
0.99	0.00	2354.00
0.99	0.00	2359.00
0.99	0.00	2364.00
0.99	0.00	2369.00
0.99	0.00	2374.00
0.99	0.00	2379.00
0.99	0.00	2384.00
0.99	0.00	2390.00
0.99	0.00	2395.00
0.99	0.00	2400.00
0.99	0.00	2405.00
0.99	0.00	2410.00
0.99	0.00	2415.00
0.99	0.00	2420.00
0.99	0.00	2425.00
0.99	0.00	2430.00
0.99	0.00	2435.00
0.99	0.00	2440.00
0.99	0.00	2445.00
0.99	0.00	2450.00
0.99	0.00	2455.00
0.99	0.00	2460.00
0.99	0.00	2465.00
0.99	0.00	2470.00
0.99	0.00	2475.00
0.99	0.00	2480.00
0.99	0.00	2485.00
0.99	0.00	2490.00
0.99	0.00	2495.00
];

position = data(:,1);
velocity = data(:,2);
time = data(:,3);
%Estimations: K = 6.28
%.64 * k = 4.0192
%t.at(4.01292) ~= .054
%1/.051 = 19.6078 = sigma
K = 6.28;
sig = 19.6078;

figure(1);
plot (time, position);
title("Position vs Time");

figure(2);

s = tf('s');
funct = K * sig/(s + sig);

[X, T] = step(funct);
hold on;
plot(T, X)
plot ((time - 1000) ./ 1000, velocity);
xlabel("Time (s)");
ylabel("Velocity (rad/s)");
title("Time vs Velocity");
title("Velocity Vs Position and open loop response");
   
hold off;

theta_d = timeseries(zeros(4000, 1) + 1, (0:3999) / 1000);

simulation = sim('PIControllerSEEDLAB');
simData = simulation.simout;
figure(3);
plot(simData.time, simData.Data(:,1));
title("Closed loop step response simulation");


outPosition = outData(:, 1);
outVelocity = outData(:, 2);
outTime = outData(:, 3);
figure(4);
hold on;
plot ((outTime - 1000) ./ 1000, outVelocity);
plot ((outTime - 1000) ./ 1000, outPosition);
title("Closed Loop Step Response Actual");

hold off;

figure (5);
hold on;
%plot of analog write vs pulse width
motorVoltages = 0:.01:5;
pulseCycle = 255;
plot(motorVoltages / 5 * pulseCycle, 0:.2:100 );
title("analogWrite pulse width");
xlabel("Written value");
ylabel('Pulse width in %');
hold off;